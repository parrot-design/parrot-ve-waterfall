var t={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"vue-waterfall-container",style:{width:t.width&&!t.isMobile?t.width+"px":"",height:parseFloat(t.height)==t.height?t.height+"px":t.height}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.isPreloading,expression:"isPreloading"}],staticClass:"loading ball-beat",class:{first:t.isFirstLoad}},[t._t("loading"),t._v(" "),t.hasLoadingSlot?t._e():t._l(t.loadingDotCount,(function(i,s){return e("div",{key:s,staticClass:"dot",style:t.loadingDotStyle})}))],2),t._v(" "),e("div",{ref:"scrollEl",staticClass:"vue-waterfall-scroll"},[t._t("waterfall-head"),t._v(" "),e("div",{staticClass:"vue-waterfall",style:t.isMobile?"":{width:t.colWidth*t.cols+"px",left:"50%",marginLeft:-1*t.colWidth*t.cols/2+"px"}},t._l(t.imgsArr_c,(function(i,s){return e("div",{key:s,staticClass:"img-box",class:[t.cardAnimationClass,{__err__:i._error}],style:{padding:t.gap_c/2+"px",width:t.isMobile?"":t.colWidth+"px"},on:{click:function(e){return t.handleClickImage(e,{value:i,index:s})}}},[e("div",{class:[t.cardClass]},[t.hasHeaderSlot?e("div",{staticClass:"img-box-header"},[t._t("header",null,{data:i})],2):t._e(),t._v(" "),i[t.srcKey]?e(t.linkName,{tag:"component",staticClass:"img-inner-box",style:{width:t.imgWidth_c+"px",height:!!i._height&&i._height+"px"},attrs:{"data-index":s}},[e("img",{attrs:{src:i[t.srcKey]}})]):t._e(),t._v(" "),t.hasFooterSlot?e("div",{staticClass:"img-box-footer"},[t._t("footer",null,{data:i})],2):t._e()],1)])})),0)],2)])},staticRenderFns:[],name:"pt-vue-waterfall",props:{width:{type:Number},height:{type:[Number,String]},loadingDotCount:{type:Number,default:3},loadingDotStyle:{type:Object},srcKey:{type:String,default:"src"},imgWidth:{type:Number,default:240},gap:{type:Number,default:20},mobileGap:{type:Number,default:8},imgsArr:{type:Array,required:!0},maxCols:{type:Number,default:5},cardAnimationClass:{type:[String],default:"default-card-animation"},cardClass:{type:[String],default:""},enablePullDownEvent:{type:Boolean,default:!1},reachBottomDistance:{type:Number,default:20}},data:()=>({isMobile:!1,isPreloading:!0,imgsArr_c:[],cols:NaN,loadedCount:0,isFirstLoad:!0,imgBoxEls:null,beginIndex:0,colsHeightArr:[],linkName:"Link"}),components:{Link:{render:function(){var t=this,i=t.$createElement;return(t._self._c||i)("div",{staticClass:"link"},[t._t("default")],2)},staticRenderFns:[],name:"Link",props:["to"]}},computed:{hasLoadingSlot(){return!!this.$scopedSlots.loading},hasFooterSlot(){return!!this.$scopedSlots.footer},hasHeaderSlot(){return!!this.$scopedSlots.header},imgWidth_c(){return this.isMobile?window.innerWidth/2:this.imgWidth},gap_c(){return this.isMobile?this.mobileGap:this.gap},colWidth(){return this.imgWidth_c+this.gap_c}},watch:{imgsArr(t,i){(this.imgsArr_c.length>t.length||this.imgsArr_c.length>0&&t[0]&&!t[0]._height)&&this.reset(),this.preload()}},methods:{preload(){this.imgsArr.forEach(((t,i)=>{if(i<this.loadedCount)return;if(!t[this.srcKey])return this.imgsArr[i]._height="0",this.loadedCount++,void(this.loadedCount==this.imgsArr.length&&this.$emit("preloaded"));let e=new Image;e.src=t[this.srcKey],e.onload=e.onerror=t=>{this.loadedCount++,this.imgsArr[i]._height="load"==t.type?Math.round(this.imgWidth_c*(e.height/e.width)):this.imgWidth_c,"error"==t.type&&(this.imgsArr[i]._error=!0,this.$emit("imgError",this.imgsArr[i])),this.loadedCount===this.imgsArr.length&&this.$emit("preloaded")}}))},calcuCols(){let t=this.width?this.width:window.innerWidth,i=Math.max(parseInt(t/this.colWidth),1);return this.isMobile?2:Math.min(i,this.maxCols)},waterfall(){if(this.imgBoxEls=this.$el.getElementsByClassName("img-box"),!this.imgBoxEls)return;let t,i,e,s=this.isMobile?this.imgBoxEls[0].offsetWidth:this.colWidth;0==this.beginIndex&&(this.colsHeightArr=[]);for(let l=this.beginIndex;l<this.imgsArr.length;l++){if(!this.imgBoxEls[l])return;if(e=this.imgBoxEls[l].offsetHeight,l<this.cols)this.colsHeightArr.push(e),t=0,i=l*s;else{let l=Math.min.apply(null,this.colsHeightArr),r=this.colsHeightArr.indexOf(l);t=l,i=r*s,this.colsHeightArr[r]=l+e}this.imgBoxEls[l].style.left=i+"px",this.imgBoxEls[l].style.top=t+"px"}this.beginIndex=this.imgsArr.length},response:function(){let t=this.cols;this.cols=this.calcuCols(),t!==this.cols&&(this.beginIndex=0,this.waterfall())},scrollFn(){let t=this.$refs.scrollEl;if(this.isPreloading)return;let i=Math.min.apply(null,this.colsHeightArr);t.scrollTop+t.offsetHeight>i-this.reachBottomDistance&&(this.isPreloading=!0,this.$emit("scrollReachBottom"))},scroll(){this.$refs.scrollEl.addEventListener("scroll",this.scrollFn)},handleClickImage(t,i){this.$emit("click",t,i)},pullDown(){let t,i=this.$el.querySelector(".vue-waterfall-scroll");i.addEventListener("touchmove",(e=>{if(0===i.scrollTop){let i=e.changedTouches[0];t||(t=i.pageY);let s=i.pageY-t;s>0&&e.preventDefault(),this.$emit("pullDownMove",s)}})),i.addEventListener("touchend",(e=>{0===i.scrollTop&&(t=NaN,this.$emit("pullDownEnd"))}))},footerHeight:function(){},reset:function(){this.imgsArr_c=[],this.beginIndex=0,this.loadedCount=0,this.isFirstLoad=!0,this.isPreloading=!0}},mounted(){this.isMobile=!!navigator.userAgent.match(/(iPhone|iPod|Android|ios)/i),this.preload(),this.cols=this.calcuCols(),this.$on("preloaded",(()=>{this.isFirstLoad=!1,this.imgsArr_c=this.imgsArr.concat([]),this.$nextTick((()=>{this.isPreloading=!1,this.waterfall()}))})),this.isMobile||this.width||window.addEventListener("resize",this.response),this.isMobile&&this.enablePullDownEvent&&this.pullDown(),this.scroll()}};const i=[t],e=function(t){i.forEach((i=>{t.component(i.name,i)}))};"undefined"!=typeof window&&window.Vue&&e(window.Vue);export{t as default,e as install};
