!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t="undefined"!=typeof globalThis?globalThis:t||self).VueWaterfall={})}(this,(function(t){"use strict";const i=()=>{if(process.client&&navigator)return!!navigator.userAgent.match(/(iPhone|iPod|Android|ios)/i)};var e={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"vue-waterfall-container",style:{width:t.width&&!t.isMobile?t.width+"px":"",height:parseFloat(t.height)==t.height?t.height+"px":t.height}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.isPreloading,expression:"isPreloading"}],staticClass:"loading ball-beat",class:{first:t.isFirstLoad}},[t._t("loading"),t._v(" "),t.hasLoadingSlot?t._e():t._l(t.loadingDotCount,(function(i,s){return e("div",{key:s,staticClass:"dot",style:t.loadingDotStyle})}))],2),t._v(" "),e("div",{ref:"scrollEl",staticClass:"vue-waterfall-scroll"},[t._t("waterfall-head"),t._v(" "),e("div",{staticClass:"vue-waterfall",style:t.isMobile?"":{width:t.colWidth*t.cols+"px",left:"50%",marginLeft:-1*t.colWidth*t.cols/2+"px"}},t._l(t.imgsArr_c,(function(i,s){return e("div",{key:s,staticClass:"img-box",class:[t.cardAnimationClass],style:{padding:t.gap_c/2+"px",width:t.isMobile?"":t.colWidth+"px"}},[i[t.srcKey]?e(t.linkName,{tag:"component",staticClass:"img-inner-box",style:{width:t.imgWidth_c+"px",height:!!i._height&&i._height+"px"},attrs:{"data-index":s}},[e("img",{attrs:{src:i[t.srcKey]}})]):t._e()],1)})),0)],2)])},staticRenderFns:[],name:"pt-vue-waterfall",props:{width:{type:Number},height:{type:[Number,String]},loadingTimeOut:{type:Number,default:500},loadingDotCount:{type:Number,default:3},loadingDotStyle:{type:Object},srcKey:{type:String,default:"src"},imgWidth:{type:Number,default:240},gap:{type:Number,default:20},mobileGap:{type:Number,default:8},imgsArr:{type:Array,required:!0},maxCols:{type:Number,default:5},cardAnimationClass:{type:[String],default:"default-card-animation"},enablePullDownEvent:{type:Boolean,default:!1},reachBottomDistance:{type:Number,default:20}},data:()=>({isMobile:i(),isPreloading:!0,imgsArr_c:[],cols:NaN,loadedCount:0,isFirstLoad:!0,imgBoxEls:null,beginIndex:0,colsHeightArr:[],linkName:"Link"}),components:{Link:{render:function(){var t=this,i=t.$createElement;return(t._self._c||i)("a",{staticClass:"link",attrs:{href:t.to,target:"_blank"}},[t._t("default")],2)},staticRenderFns:[],name:"Link",props:["to"]}},computed:{hasLoadingSlot(){return!!this.$scopedSlots.loading},imgWidth_c(){return this.isMobile?window.innerWidth/2:this.imgWidth},gap_c(){return this.isMobile?this.mobileGap:this.gap},colWidth(){return this.imgWidth_c+this.gap_c}},watch:{imgsArr(t,i){(this.imgsArr_c.length>t.length||this.imgsArr_c.length>0&&t[0]&&!t[0]._height)&&this.reset(),this.preload()}},methods:{preload(t,i){this.imgsArr.forEach(((t,i)=>{if(i<this.loadedCount)return;if(!t[this.srcKey])return this.imgsArr[i]._height="0",this.loadedCount++,void(this.loadedCount==this.imgsArr.length&&this.$emit("preloaded"));let e=new Image;e.src=t[this.srcKey],e.onload=e.onerror=t=>{this.loadedCount++,this.imgsArr[i]._height="load"==t.type?Math.round(this.imgWidth_c*(e.height/e.width)):this.imgWidth_c,"error"==t.type&&(this.imgsArr[i]._error=!0,this.$emit("imgError",this.imgsArr[i])),this.loadedCount===this.imgsArr.length&&this.$emit("preloaded")}}))},calcuCols(){let t=this.width?this.width:window.innerWidth,i=Math.max(parseInt(t/this.colWidth),1);return this.isMobile?2:Math.min(i,this.maxCols)},waterfall(){if(this.imgBoxEls=this.$el.getElementsByClassName("img-box"),!this.imgBoxEls)return;let t,i,e,s=this.isMobile?this.imgBoxEls[0].offsetWidth:this.colWidth;0==this.beginIndex&&(this.colsHeightArr=[]);for(let l=this.beginIndex;l<this.imgsArr.length;l++){if(!this.imgBoxEls[l])return;if(e=this.imgBoxEls[l].offsetHeight,l<this.cols)this.colsHeightArr.push(e),t=0,i=l*s;else{let l=Math.min.apply(null,this.colsHeightArr),r=this.colsHeightArr.indexOf(l);t=l,i=r*s,this.colsHeightArr[r]=l+e}this.imgBoxEls[l].style.left=i+"px",this.imgBoxEls[l].style.top=t+"px"}this.beginIndex=this.imgsArr.length},response:function(){let t=this.cols;this.cols=this.calcuCols(),t!==this.cols&&(this.beginIndex=0,this.waterfall())},scrollFn(){let t=this.$refs.scrollEl;if(this.isPreloading)return;let i=Math.min.apply(null,this.colsHeightArr);t.scrollTop+t.offsetHeight>i-this.reachBottomDistance&&(this.isPreloading=!0,this.$emit("scrollReachBottom"))},scroll(){this.$refs.scrollEl.addEventListener("scroll",this.scrollFn)},bindClickEvent(){this.$el.querySelector(".vue-waterfall").addEventListener("click",(t=>{let i=t.target,e=i.className;if(-1!=e.indexOf("img-box"))return;for(;-1==e.indexOf("img-inner-box");)i=i.parentNode;let s=i.getAttribute("data-index");this.$emit("click",t,{index:s,value:this.imgsArr_c[s]})}))},pullDown(){let t,i=this.$el.querySelector(".vue-waterfall-scroll");i.addEventListener("touchmove",(e=>{if(0===i.scrollTop){let i=e.changedTouches[0];t||(t=i.pageY);let s=i.pageY-t;s>0&&e.preventDefault(),this.$emit("pullDownMove",s)}})),i.addEventListener("touchend",(e=>{0===i.scrollTop&&(t=NaN,this.$emit("pullDownEnd"))}))},reset:function(){this.imgsArr_c=[],this.beginIndex=0,this.loadedCount=0,this.isFirstLoad=!0,this.isPreloading=!0}},mounted(){this.bindClickEvent(),this.preload(),this.cols=this.calcuCols(),this.$on("preloaded",(()=>{this.isFirstLoad=!1,this.imgsArr_c=this.imgsArr.concat([]),this.$nextTick((()=>{this.isPreloading=!1,this.waterfall()}))})),this.isMobile||this.width||window.addEventListener("resize",this.response),this.isMobile&&this.enablePullDownEvent&&this.pullDown(),this.scroll()}};const s=[e],l=function(t){s.forEach((i=>{t.component(i.name,i)}))};"undefined"!=typeof window&&window.Vue&&l(window.Vue),t.default=e,t.install=l,Object.defineProperty(t,"__esModule",{value:!0})}));
